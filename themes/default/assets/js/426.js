"use strict";(self.webpackChunkjohncms=self.webpackChunkjohncms||[]).push([[426],{1426:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ne});var a=s(821),n={class:"mt-4"},i={class:"fw-bold"},o={key:0,class:"text-success"},r={key:0,class:"alert alert-info"},l={class:"new_post-header d-flex justify-content-between"},d={class:"post-user"},c=["href"],m={class:"avatar"},u=["src"],_=["title"],g=[(0,a._)("svg",{class:"icon-post"},[(0,a._)("use",{"xlink:href":"/themes/default/assets/icons/sprite.svg?#check"})],-1)],p={class:"flex-grow-1 post-user d-flex flex-wrap overflow-hidden d-flex align-items-center"},f={class:"w-100"},w=["href"],h={class:"user-name d-inline me-2"},v={key:1,class:"user-name d-inline me-2"},k={class:"post-meta d-inline me-2","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Link to post"},y={key:0,class:"overflow-hidden text-nowrap text-dark-brown overflow-ellipsis small"},b={class:"fw-bold"},x=["innerHTML"],C={class:"post-footer d-flex justify-content-between"},q={class:"overflow-hidden"},D={key:0,class:"post-meta d-flex"},z={class:"user-ip me-2"},S=["href"],M={class:"useragent"},P={class:"d-flex"},j={key:0,class:"ms-3"},T=["onClick"],U={key:1,class:"ms-3"},F=["onClick"],H={key:2,class:"dropdown ms-3"},L=(0,a._)("div",{class:"cursor-pointer","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[(0,a._)("svg",{class:"icon text-primary"},[(0,a._)("use",{"xlink:href":"/themes/default/assets/icons/sprite.svg?#more_horizontal"})])],-1),R={class:"dropdown-menu dropdown-menu-right"},V=["onClick"],W={key:1,class:"mt-4"},A={class:"fw-bold"},B={key:0,class:"d-flex"},E={class:"alert alert-danger d-inline"},K={key:1,class:"d-flex"},N={class:"alert alert-success d-inline"},O={style:{"max-width":"800px"}},Q={class:"form-group"},X={class:"mt-2"},Y=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},G=(0,a._)("div",null,null,-1);var I=s(9669),J=s.n(I),$=s(6486),ee=s.n($),te=s(9755),se=s.n(te);const ae={name:"CommentsComponent",props:{article_id:Number,can_write:{type:Boolean,default:!1},i18n:{type:Object,default:function(){return{write_comment:"Write a comment",send:"Send",delete:"Delete",quote:"Quote",reply:"Reply",comments:"Comments",empty_list:"The list is empty"}}},language:{type:String,default:"en"},upload_url:{type:String,default:""},csrf_token:{type:String,default:""}},data:function(){return{messages:{},comment_text:"",comment_added_message:"",error_message:"",loading:!1,attached_files:[]}},mounted:function(){var e=this;this.getComments();var t={simpleUpload:{uploadUrl:this.upload_url,headers:{"X-CSRF-Token":this.csrf_token},withCredentials:!1,savedCallback:function(t){e.attached_files.push(t.id)}},language:this.language};ClassicEditor.create(document.querySelector("#comment_text"),t).then((function(t){window.editor=t,t.model.document.on("change:data",(function(){e.comment_text=t.getData()}))}))},updated:function(){se()(".image-preview").magnificPopup({type:"image",image:{verticalFit:!0,titleSrc:function(e){return e.el.attr("title")+' &middot; <a class="image-source-link" href="'+e.el.attr("data-source")+'" target="_blank">Download</a>'}},zoom:{enabled:!0,duration:300,opener:function(e){return e.find("img")}}})},computed:{},methods:{getComments:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.loading=!0,J().get("/news/comments/"+this.article_id+"/?page="+t).then((function(t){e.messages=t.data,e.loading=!1})).catch((function(t){alert(t),e.loading=!1}))},reply:function(e){editor.editing.view.focus(),editor.model.change((function(t){var s=editor.model.document.selection.getFirstPosition();t.insertText(e.user.user_name+", ",{},s),t.setSelection(t.createPositionAt(editor.model.document.getRoot(),"end"))}))},quote:function(e){var t=e.text.replace(/(<([^>]+)>)/gi,""),s="<blockquote><p>"+e.user.user_name+", "+e.created_at+"<br>"+t+"</p></blockquote><p></p>",a=editor.data.processor.toView(s),n=editor.data.toModel(a);editor.model.insertContent(n),editor.editing.view.focus()},sendComment:function(){var e=this;this.loading=!0,J().post("/news/comments/add/"+this.article_id+"/",{comment:this.comment_text,attached_files:this.attached_files}).then((function(t){e.comment_added_message=t.data.message,e.loading=!1,e.comment_text="",e.error_message="",e.attached_files=[],window.editor.setData(""),e.getComments(t.data.last_page)})).catch((function(t){e.error_message=t.response.data.message,e.loading=!1}))},delComment:function(e){var t=this;this.loading=!0,J().post("/news/comments/del/",{comment_id:e}).then((function(){t.getComments(t.messages.current_page)})).catch((function(e){alert(e.response.data.message),t.loading=!1}))},__:function(e){return ee().get(this.i18n,e,"")}}};const ne=(0,s(3744).Z)(ae,[["render",function(e,t,s,I,J,$){var ee=(0,a.up)("pagination");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("h3",i,[(0,a.Uk)((0,a.zw)($.__("comments"))+" ",1),J.messages.total>0?((0,a.wg)(),(0,a.iD)("span",o,(0,a.zw)(J.messages.total),1)):(0,a.kq)("",!0)]),J.messages.data&&J.messages.data.length<1?((0,a.wg)(),(0,a.iD)("div",r,(0,a.zw)($.__("empty_list")),1)):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(J.messages.data,(function(e,t){return(0,a.wg)(),(0,a.iD)("div",{class:"new_post-item",key:t},[(0,a._)("div",l,[(0,a._)("div",d,[e.user.profile_url?((0,a.wg)(),(0,a.iD)("a",{key:0,href:e.user.profile_url},[(0,a._)("div",m,[(0,a._)("img",{src:e.user.avatar,class:"img-fluid",alt:"."},null,8,u)])],8,c)):(0,a.kq)("",!0),(0,a._)("span",{class:(0,a.C_)(["user-status shadow",e.user.is_online?"online":"offline"])},null,2),e.user.rights_name?((0,a.wg)(),(0,a.iD)("div",{key:1,class:"post-of-user","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-html":"true",title:e.user.rights_name},g,8,_)):(0,a.kq)("",!0)]),(0,a._)("div",p,[(0,a._)("div",f,[e.user.profile_url?((0,a.wg)(),(0,a.iD)("a",{key:0,href:e.user.profile_url},[(0,a._)("span",h,(0,a.zw)(e.user.user_name),1)],8,w)):(0,a.kq)("",!0),e.user.profile_url?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",v,(0,a.zw)(e.user.user_name),1)),(0,a._)("span",k,(0,a.zw)(e.created_at),1)]),e.user.status?((0,a.wg)(),(0,a.iD)("div",y,[(0,a._)("span",b,(0,a.zw)(e.user.status),1)])):(0,a.kq)("",!0)])]),(0,a._)("div",{class:"post-body pt-2 pb-2",innerHTML:e.text},null,8,x),(0,a._)("div",C,[(0,a._)("div",q,[e.ip?((0,a.wg)(),(0,a.iD)("div",D,[(0,a._)("div",z,[(0,a._)("a",{href:e.search_ip_url},(0,a.zw)(e.ip),9,S)]),(0,a._)("div",M,[(0,a._)("span",null,(0,a.zw)(e.user_agent),1)])])):(0,a.kq)("",!0)]),(0,a._)("div",P,[e.can_reply?((0,a.wg)(),(0,a.iD)("div",j,[(0,a._)("a",{href:"#",onClick:(0,a.iM)((function(t){return $.reply(e)}),["prevent"])},(0,a.zw)($.__("reply")),9,T)])):(0,a.kq)("",!0),e.can_quote?((0,a.wg)(),(0,a.iD)("div",U,[(0,a._)("a",{href:"#",onClick:(0,a.iM)((function(t){return $.quote(e)}),["prevent"])},(0,a.zw)($.__("quote")),9,F)])):(0,a.kq)("",!0),e.can_delete?((0,a.wg)(),(0,a.iD)("div",H,[L,(0,a._)("div",R,[(0,a._)("a",{class:"dropdown-item",href:"",onClick:(0,a.iM)((function(t){return $.delComment(e.id)}),["prevent"])},(0,a.zw)($.__("delete")),9,V)])])):(0,a.kq)("",!0)])])])})),128)),(0,a.Wm)(ee,{data:J.messages,onPaginationChangePage:$.getComments,class:"mt-3"},null,8,["data","onPaginationChangePage"]),s.can_write?((0,a.wg)(),(0,a.iD)("div",W,[(0,a._)("h3",A,(0,a.zw)($.__("write_comment")),1),(0,a._)("form",{action:"",onSubmit:t[1]||(t[1]=(0,a.iM)((function(){return $.sendComment&&$.sendComment.apply($,arguments)}),["prevent"]))},[J.error_message?((0,a.wg)(),(0,a.iD)("div",B,[(0,a._)("div",E,(0,a.zw)(J.error_message),1)])):(0,a.kq)("",!0),J.comment_added_message?((0,a.wg)(),(0,a.iD)("div",K,[(0,a._)("div",N,(0,a.zw)(J.comment_added_message),1)])):(0,a.kq)("",!0),(0,a._)("div",O,[(0,a._)("div",Q,[(0,a.wy)((0,a._)("textarea",{name:"text",id:"comment_text",required:"",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=function(e){return J.comment_text=e})},null,512),[[a.nr,J.comment_text]])])]),(0,a._)("div",X,[(0,a._)("button",{type:"submit",name:"submit",value:"1",class:"btn btn-primary",disabled:J.loading},[J.loading?((0,a.wg)(),(0,a.iD)("span",Z)):(0,a.kq)("",!0),(0,a.Uk)(" "+(0,a.zw)($.__("send")),1)],8,Y),G])],32)])):(0,a.kq)("",!0)])}]])}}]);